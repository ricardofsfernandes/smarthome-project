<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartHome - Lista de Compras</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h2>Minha Lista de Compras</h2>
        </header>

        <div class="input-group">
            <input type="text" id="itemInput" placeholder="Item (ex: PÃ£o)">
            <input type="number" id="qtdInput" placeholder="Qtd" value="1">
            <button id="add-btn" onclick="adicionarItem()">Adicionar Item</button>
        </div>

        <div id="lista-compras">
            <p style="text-align:center;">A carregar lista...</p>
        </div>
    </div>

    <script>
    // URL do teu Backend no Render
        const API_URL = 'https://smarthome-project.onrender.com/compras';

        async function carregarLista() {
            try {
                const res = await fetch(API_URL);
                const dados = await res.json();
                renderizarLista(dados);
            } catch (err) {
                console.error("Erro ao carregar:", err);
            }
        }

        function renderizarLista(itens) {
            const container = document.getElementById('lista-compras');
            container.innerHTML = '';
            
            itens.forEach(item => {
                container.innerHTML += `
                    <div class="item">
                        <div>
                            <strong>${item.item}</strong> <br>
                            <small>Qtd: ${item.quantidade}</small>
                        </div>
                        <button class="del-btn" onclick="apagarItem('${item._id}')">Apagar</button>
                    </div>
                `;
            });
        }

        async function adicionarItem() {
            const nome = document.getElementById('itemInput').value;
            const qtd = document.getElementById('qtdInput').value;

            if (!nome) return alert("Escreve o nome do item!");

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ item: nome, quantidade: qtd })
                });
                const novaLista = await res.json();
                renderizarLista(novaLista);
                document.getElementById('itemInput').value = '';
            } catch (err) {
                alert("Erro ao adicionar!");
            }
        }

        async function apagarItem(id) {
            try {
                const res = await fetch(`${API_URL}/limpar/${id}`);
                const novaLista = await res.json();
                renderizarLista(novaLista);
            } catch (err) {
                alert("Erro ao apagar!");
            }
        }

        // Iniciar
        carregarLista();
</script>
</body>
</html>