<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>SmartHome - Lista de Compras</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <h1>Minha Lista de Compras</h1>

    <div style="margin-bottom: 20px;">
        <input type="text" id="itemNome" placeholder="Item (ex: Pão)">
        <input type="number" id="itemQtd" placeholder="Qtd" style="width: 50px;">
        <button onclick="adicionarItem()">Adicionar</button>
    </div>

    <div id="lista">
        <p>A carregar lista do servidor...</p>
    </div>

    <script>
    const API_URL = 'http://localhost:3000/compras';

    async function carregarCompras() {
        const resposta = await fetch(API_URL);
        const dados = await resposta.json();
        const divLista = document.getElementById('lista');
        divLista.innerHTML = ''; 

        dados.forEach(item => {
            // Adicionamos um botão que chama a função apagarItem com o ID correto
            divLista.innerHTML += `
                <div class="item" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${item.item} - Qtd: ${item.quantidade}</span>
                    <button onclick="apagarItem(${item.id})" style="background: #ff4444; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px;">
                        Apagar
                    </button>
                </div>`;
        });
    }

    async function adicionarItem() {
        const nome = document.getElementById('itemNome').value;
        const qtd = document.getElementById('itemQtd').value;

        if (!nome || !qtd) return alert("Preenche os campos!");

        await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ item: nome, quantidade: parseInt(qtd) })
        });

        document.getElementById('itemNome').value = '';
        document.getElementById('itemQtd').value = '';
        carregarCompras();
    }

    // NOVA FUNÇÃO: Apagar
    async function apagarItem(id) {
        // Usamos a rota que criámos no backend: /compras/limpar/:id
        await fetch(`${API_URL}/limpar/${id}`);
        carregarCompras(); // Atualiza a lista após apagar
    }

    carregarCompras();
</script>
</body>
</html>