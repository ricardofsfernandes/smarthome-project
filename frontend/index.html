<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartHome - Lista de Compras</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h2>Mercado <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart-icon lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg></h2>
        </header>

        <div class="input-group">
            <input type="text" id="itemInput" placeholder="Item (ex: Pão)">
            <input type="number" id="qtdInput" placeholder="0" inputmode="numeric" pattern="[0-9]*">
            <button id="add-btn" onclick="adicionarItem()">Adicionar Item</button>
        </div>

        <div id="lista-compras">
            <p style="text-align:center;">A carregar lista...</p>
        </div>
    </div>

    <script>
    // URL do teu Backend no Render
        const API_URL = 'https://smarthome-project.onrender.com/compras';

        async function carregarLista() {
            try {
                const res = await fetch(API_URL);
                const dados = await res.json();
                renderizarLista(dados);
            } catch (err) {
                console.error("Erro ao carregar:", err);
            }
        }

        function renderizarLista(itens) {
            const container = document.getElementById('lista-compras');
            container.innerHTML = '';
            
            itens.forEach(item => {
                container.innerHTML += `
                    <div class="item">
                        <div>
                            <strong>${item.item}</strong> <br>
                            <small>Qtd: ${item.quantidade}</small>
                        </div>
                        <button class="del-btn" onclick="apagarItem('${item._id}')">Apagar</button>
                    </div>
                `;
            });
        }

        async function adicionarItem() {
            const itemInput = document.getElementById('itemInput');
            const qtdInput = document.getElementById('qtdInput');
            
            const nome = itemInput.value;
            const qtd = qtdInput.value || 1;

            if (!nome) return alert("Escreve o nome do item!");

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ item: nome, quantidade: qtd })
                });
                const novaLista = await res.json();
                renderizarLista(novaLista);
                
                // LIMPEZA: Limpa ambos os campos após adicionar
                itemInput.value = '';
                qtdInput.value = ''; 
                
                // Volta o cursor para o nome do item
                itemInput.focus();
            } catch (err) {
                alert("Erro ao adicionar!");
            }
        }

        async function apagarItem(id) {
            try {
                const res = await fetch(`${API_URL}/limpar/${id}`);
                const novaLista = await res.json();
                renderizarLista(novaLista);
            } catch (err) {
                alert("Erro ao apagar!");
            }
        }

        // Iniciar
        carregarLista();
</script>
</body>
</html>